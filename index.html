<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ToolBox Hub - Central de Ferramentas</title>

    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide Icons via CDN -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @layer utilities {
            .animate-fade-in {
                animation: fadeIn 0.4s ease-out;
            }

            .animate-slide-up {
                animation: slideUp 0.4s ease-out;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Custom Toast for Copy action */
        #toast {
            visibility: hidden;
            min-width: 250px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 8px;
            padding: 12px;
            position: fixed;
            z-index: 50;
            left: 50%;
            bottom: 30px;
            transform: translateX(-50%);
            font-size: 14px;
        }

        #toast.show {
            visibility: visible;
            animation: fadein 0.5s, fadeout 0.5s 2.5s;
        }

        @keyframes fadein {
            from {
                bottom: 0;
                opacity: 0;
            }

            to {
                bottom: 30px;
                opacity: 1;
            }
        }

        @keyframes fadeout {
            from {
                bottom: 30px;
                opacity: 1;
            }

            to {
                bottom: 0;
                opacity: 0;
            }
        }
    </style>
</head>

<body class="min-h-screen bg-gray-50 text-gray-800 font-sans overflow-x-hidden">

    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-100 sticky top-0 z-40">
        <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
            <div class="flex items-center gap-2 cursor-pointer transition-transform hover:scale-105"
                onclick="app.goHome()">
                <div class="bg-blue-600 text-white p-2 rounded-lg">
                    <i data-lucide="qr-code"></i>
                </div>
                <h1
                    class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-indigo-600">
                    ToolBox Hub
                </h1>
            </div>
            <button id="btn-back" onclick="app.goHome()"
                class="hidden flex items-center gap-2 text-sm font-medium text-gray-500 hover:text-gray-900 bg-gray-100 px-4 py-2 rounded-full transition-colors">
                <i data-lucide="arrow-left" class="w-4 h-4"></i> Voltar ao In√≠cio
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-6xl mx-auto px-4 py-8">

        <!-- Tela Inicial (Grid) -->
        <div id="view-home" class="animate-fade-in">
            <div class="text-center mb-10">
                <h2 class="text-3xl font-bold text-gray-900 mb-4">Todas as ferramentas que voc√™ precisa.</h2>
                <p class="text-gray-500 max-w-2xl mx-auto">
                    Um canivete su√≠√ßo digital com utilit√°rios gratuitos, r√°pidos e que funcionam direto no seu
                    navegador. Escolha um bloco abaixo para come√ßar.
                </p>
            </div>
            <div id="tools-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 lg:grid-cols-5 gap-4">
                <!-- Injetado via JS -->
            </div>
        </div>

        <!-- Tela da Ferramenta -->
        <div id="view-tool"
            class="hidden animate-slide-up bg-white rounded-3xl shadow-xl border border-gray-100 overflow-hidden min-h-[60vh]">
            <div id="tool-container"></div>
        </div>

    </main>

    <!-- Toast Notification -->
    <div id="toast">Copiado para a √°rea de transfer√™ncia!</div>

    <!-- L√≥gica da Aplica√ß√£o -->
    <script>
        // --- Utilit√°rios Globais ---
        const utils = {
            copyToClipboard: (text) => {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);

                const toast = document.getElementById("toast");
                toast.className = "show";
                setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 3000);
            },
            executeWithRetry: async (fn, retries = 5) => {
                const delays = [1000, 2000, 4000, 8000, 16000];
                for (let i = 0; i < retries; i++) {
                    try { return await fn(); }
                    catch (err) {
                        if (i === retries - 1) throw err;
                        await new Promise(res => setTimeout(res, delays[i]));
                    }
                }
            },
            formatBytes: (bytes) => {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
        };

        // --- Defini√ß√£o das Ferramentas ---
        const toolsData = [
            {
                id: 'qrcode', title: 'Gerador QR Code', icon: 'qr-code', color: 'bg-blue-500',
                html: () => `
          <div class="p-8 max-w-2xl mx-auto flex flex-col items-center">
            <h2 class="text-2xl font-bold mb-6 flex items-center gap-2"><i data-lucide="qr-code" class="text-blue-500"></i> Gerador de QR Code</h2>
            <div class="w-full relative mb-8">
              <input type="text" id="qr-input" value="https://exemplo.com" placeholder="Cole sua URL ou texto aqui..." class="w-full p-4 pl-6 pr-12 text-lg bg-gray-50 border border-gray-200 rounded-2xl focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all outline-none" />
              <button id="qr-clear" class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600"><i data-lucide="trash-2" class="w-5 h-5"></i></button>
            </div>
            <div class="bg-gray-50 p-6 rounded-3xl border border-gray-100 shadow-inner flex flex-col items-center gap-6 w-full">
              <img id="qr-img" src="https://api.qrserver.com/v1/create-qr-code/?size=400x400&data=https%3A%2F%2Fexemplo.com" class="w-64 h-64 rounded-xl shadow-md transition-all duration-500 hover:scale-105" />
              <button id="qr-download" class="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-xl font-semibold transition-all shadow-lg transform hover:-translate-y-1">
                <i data-lucide="download" class="w-5 h-5"></i> Baixar Imagem (PNG)
              </button>
            </div>
          </div>`,
                init: () => {
                    const input = document.getElementById('qr-input');
                    const img = document.getElementById('qr-img');
                    const clearBtn = document.getElementById('qr-clear');
                    const downloadBtn = document.getElementById('qr-download');

                    const updateQR = () => {
                        const val = input.value;
                        if (val) img.src = `https://api.qrserver.com/v1/create-qr-code/?size=400x400&data=${encodeURIComponent(val)}`;
                        else img.src = '';
                    };
                    input.addEventListener('input', updateQR);
                    clearBtn.addEventListener('click', () => { input.value = ''; updateQR(); });
                    downloadBtn.addEventListener('click', async () => {
                        if (!img.src) return;
                        try {
                            const res = await fetch(img.src);
                            const blob = await res.blob();
                            const a = document.createElement('a');
                            a.href = URL.createObjectURL(blob);
                            a.download = 'qrcode.png';
                            a.click();
                        } catch (e) { window.open(img.src, '_blank'); }
                    });
                }
            },
            {
                id: 'colors', title: 'Paleta de Cores', icon: 'palette', color: 'bg-pink-500',
                html: () => `
          <div class="p-8 max-w-4xl mx-auto flex flex-col items-center">
            <h2 class="text-2xl font-bold mb-6 flex items-center gap-2"><i data-lucide="palette" class="text-pink-500"></i> Gerador de Paletas</h2>
            <form id="color-form" class="flex gap-2 w-full max-w-xl mb-10">
              <input type="text" id="color-idea" placeholder="Ex: Oceano, P√¥r do sol, Neon..." class="flex-1 p-3 px-5 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-pink-200 outline-none" />
              <button type="submit" class="bg-pink-500 hover:bg-pink-600 text-white px-6 py-3 rounded-xl font-semibold flex items-center gap-2">Gerar</button>
            </form>
            <div id="color-palette" class="flex flex-col sm:flex-row w-full h-64 sm:h-80 rounded-3xl overflow-hidden shadow-xl border border-gray-100 relative group">
              <!-- Colors -->
            </div>
            <p class="mt-6 text-gray-500 text-sm">Clique em qualquer cor para copiar o c√≥digo HEX.</p>
          </div>`,
                init: () => {
                    const form = document.getElementById('color-form');
                    const input = document.getElementById('color-idea');
                    const palette = document.getElementById('color-palette');

                    const hslToHex = (h, s, l) => {
                        l /= 100; const a = s * Math.min(l, 1 - l) / 100;
                        const f = n => { const k = (n + h / 30) % 12; const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1); return Math.round(255 * color).toString(16).padStart(2, '0'); };
                        return `#${f(0)}${f(8)}${f(4)}`.toUpperCase();
                    };

                    const renderColors = (colorsHex) => {
                        palette.innerHTML = colorsHex.map(c => `
              <div class="flex-1 flex items-end justify-center pb-6 sm:pb-8 relative cursor-pointer group transition-all duration-300 hover:flex-[1.5]" style="background-color: ${c}" onclick="utils.copyToClipboard('${c}')">
                <span class="bg-white bg-opacity-90 px-4 py-2 rounded-xl text-gray-800 font-mono font-bold shadow-sm z-10 select-none">${c}</span>
              </div>
            `).join('');
                    };

                    const generate = (e) => {
                        if (e) e.preventDefault();
                        const idea = input.value;
                        const seed = idea ? idea.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0) : Math.random() * 1000;
                        const newColors = Array.from({ length: 5 }).map((_, i) => hslToHex((seed * 137.5 + i * 72) % 360, 70, 60));
                        renderColors(newColors);
                    };

                    form.addEventListener('submit', generate);
                    generate(); // init default
                }
            },
            {
                id: 'text', title: 'Formatador', icon: 'type', color: 'bg-emerald-500',
                html: () => `
          <div class="p-6 sm:p-8 max-w-4xl mx-auto flex flex-col h-full">
            <div class="flex justify-between items-center mb-6">
              <h2 class="text-2xl font-bold flex items-center gap-2"><i data-lucide="type" class="text-emerald-500"></i> Formatador de Texto</h2>
              <button id="tf-copy" class="px-3 py-1.5 rounded-lg text-sm font-semibold bg-emerald-100 text-emerald-800 hover:bg-emerald-200"><i data-lucide="copy" class="w-4 h-4 inline mr-1"></i>Copiar</button>
            </div>
            <div id="tf-actions" class="flex flex-wrap gap-2 mb-4">
               <button data-action="up" class="px-3 py-1.5 bg-white border border-gray-200 rounded-lg text-sm font-medium hover:bg-emerald-50">MAI√öSCULAS</button>
               <button data-action="low" class="px-3 py-1.5 bg-white border border-gray-200 rounded-lg text-sm font-medium hover:bg-emerald-50">min√∫sculas</button>
               <button data-action="cap" class="px-3 py-1.5 bg-white border border-gray-200 rounded-lg text-sm font-medium hover:bg-emerald-50">Capitalizadas</button>
               <button data-action="space" class="px-3 py-1.5 bg-white border border-gray-200 rounded-lg text-sm font-medium hover:bg-emerald-50">Sem Espa√ßos</button>
               <button data-action="clear" class="px-3 py-1.5 bg-red-50 text-red-600 rounded-lg text-sm font-medium ml-auto">Limpar</button>
            </div>
            <textarea id="tf-area" placeholder="Cole seu texto aqui..." class="w-full flex-1 min-h-[300px] p-6 bg-gray-50 border border-gray-200 rounded-2xl resize-none outline-none font-mono text-gray-700"></textarea>
          </div>`,
                init: () => {
                    const area = document.getElementById('tf-area');
                    document.getElementById('tf-copy').addEventListener('click', () => utils.copyToClipboard(area.value));
                    document.getElementById('tf-actions').addEventListener('click', (e) => {
                        if (e.target.tagName !== 'BUTTON') return;
                        const act = e.target.dataset.action;
                        let t = area.value;
                        if (act === 'up') t = t.toUpperCase();
                        if (act === 'low') t = t.toLowerCase();
                        if (act === 'cap') t = t.replace(/\b\w/g, c => c.toUpperCase());
                        if (act === 'space') t = t.replace(/\s+/g, ' ').trim();
                        if (act === 'clear') t = '';
                        area.value = t;
                    });
                }
            },
            {
                id: 'counter', title: 'Contador', icon: 'hash', color: 'bg-yellow-500',
                html: () => `
          <div class="p-6 sm:p-8 max-w-4xl mx-auto flex flex-col h-full">
            <h2 class="text-2xl font-bold mb-6 flex items-center gap-2"><i data-lucide="hash" class="text-yellow-500"></i> Contador</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
              <div class="bg-yellow-50 border border-yellow-100 rounded-2xl p-4 flex flex-col items-center">
                <span id="cc-char" class="text-3xl font-black text-yellow-600">0</span><span class="text-xs font-bold text-yellow-800 uppercase">Caracteres</span>
              </div>
              <div class="bg-yellow-50 border border-yellow-100 rounded-2xl p-4 flex flex-col items-center">
                <span id="cc-word" class="text-3xl font-black text-yellow-600">0</span><span class="text-xs font-bold text-yellow-800 uppercase">Palavras</span>
              </div>
              <div class="bg-yellow-50 border border-yellow-100 rounded-2xl p-4 flex flex-col items-center">
                <span id="cc-sent" class="text-3xl font-black text-yellow-600">0</span><span class="text-xs font-bold text-yellow-800 uppercase">Frases</span>
              </div>
              <div class="bg-yellow-50 border border-yellow-100 rounded-2xl p-4 flex flex-col items-center">
                <span id="cc-para" class="text-3xl font-black text-yellow-600">0</span><span class="text-xs font-bold text-yellow-800 uppercase">Par√°grafos</span>
              </div>
            </div>
            <textarea id="cc-area" placeholder="Digite aqui..." class="w-full flex-1 min-h-[250px] p-6 bg-gray-50 border rounded-2xl outline-none"></textarea>
          </div>`,
                init: () => {
                    const area = document.getElementById('cc-area');
                    const els = { char: document.getElementById('cc-char'), word: document.getElementById('cc-word'), sent: document.getElementById('cc-sent'), para: document.getElementById('cc-para') };
                    area.addEventListener('input', () => {
                        const t = area.value;
                        els.char.innerText = t.length;
                        els.word.innerText = t.trim() ? t.trim().split(/\s+/).length : 0;
                        els.sent.innerText = t.trim() ? t.split(/[.!?]+/).filter(Boolean).length : 0;
                        els.para.innerText = t.trim() ? t.split(/\n+/).filter(Boolean).length : 0;
                    });
                }
            },
            {
                id: 'bgremove', title: 'Remove Fundo', icon: 'image', color: 'bg-cyan-500',
                html: () => `
          <div class="p-8 max-w-4xl mx-auto flex flex-col items-center">
            <h2 class="text-2xl font-bold mb-2 flex items-center gap-2"><i data-lucide="image" class="text-cyan-500"></i> Removedor de Fundo IA</h2>
            <p class="text-sm text-gray-500 mb-8 text-center">Alimentado pelo Google Gemini. Remove o fundo perfeitamente.</p>
            
            <label id="bgr-upload-area" class="w-full max-w-xl h-64 border-2 border-dashed border-cyan-300 bg-cyan-50 hover:bg-cyan-100 transition-colors rounded-3xl flex flex-col items-center justify-center cursor-pointer text-cyan-700">
              <i data-lucide="upload" class="w-10 h-10 mb-4 text-cyan-400"></i>
              <span class="font-semibold text-lg">Selecione uma Imagem</span>
              <input type="file" id="bgr-file" class="hidden" accept="image/*" />
            </label>

            <div id="bgr-workspace" class="w-full flex-col items-center gap-6 hidden">
              <div class="flex flex-col md:flex-row gap-6 w-full items-center justify-center">
                <div class="flex flex-col items-center">
                  <span class="text-sm font-bold text-gray-500 mb-2">Original</span>
                  <img id="bgr-original" class="w-64 h-64 object-cover rounded-2xl shadow-sm border bg-white" />
                </div>
                <div class="flex flex-col items-center gap-4">
                  <button id="bgr-btn" class="bg-cyan-600 hover:bg-cyan-700 text-white px-6 py-3 rounded-xl font-bold flex items-center gap-2">Remover Fundo</button>
                  <div id="bgr-loading" class="hidden flex-col items-center text-cyan-600 gap-2">
                    <i data-lucide="refresh-cw" class="w-8 h-8 animate-spin"></i>
                    <span class="text-sm font-semibold animate-pulse">Processando...</span>
                  </div>
                </div>
                <div class="flex flex-col items-center relative">
                  <span class="text-sm font-bold text-cyan-600 mb-2">Resultado</span>
                  <div class="w-64 h-64 rounded-2xl shadow-md border border-cyan-200 relative overflow-hidden flex items-center justify-center" style="background-image: repeating-linear-gradient(45deg, #f0f0f0 25%, transparent 25%, transparent 75%, #f0f0f0 75%, #f0f0f0), repeating-linear-gradient(45deg, #f0f0f0 25%, #ffffff 25%, #ffffff 75%, #f0f0f0 75%, #f0f0f0); background-position: 0 0, 10px 10px; background-size: 20px 20px;">
                     <img id="bgr-result" class="hidden w-full h-full object-contain drop-shadow-2xl" />
                     <span id="bgr-placeholder" class="text-gray-400">Aguardando...</span>
                  </div>
                </div>
              </div>
              <p id="bgr-error" class="text-red-500 font-semibold hidden"></p>
              <div class="flex gap-4 mt-4">
                <button id="bgr-reset" class="px-6 py-2 bg-gray-100 rounded-lg">Tentar Outra</button>
                <a id="bgr-download" download="recorte-gemini.png" class="hidden bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg font-bold items-center gap-2"><i data-lucide="download" class="w-4 h-4"></i> Baixar Imagem</a>
              </div>
            </div>
          </div>`,
                init: () => {
                    let base64Data = '', mimeType = '';
                    const fileInput = document.getElementById('bgr-file');
                    const uploadArea = document.getElementById('bgr-upload-area');
                    const workspace = document.getElementById('bgr-workspace');
                    const imgOrig = document.getElementById('bgr-original');
                    const imgRes = document.getElementById('bgr-result');
                    const btn = document.getElementById('bgr-btn');
                    const loading = document.getElementById('bgr-loading');
                    const placeholder = document.getElementById('bgr-placeholder');
                    const errorMsg = document.getElementById('bgr-error');
                    const btnReset = document.getElementById('bgr-reset');
                    const btnDown = document.getElementById('bgr-download');

                    fileInput.addEventListener('change', (e) => {
                        const file = e.target.files[0];
                        if (!file) return;
                        mimeType = file.type;
                        const reader = new FileReader();
                        reader.onload = (event) => {
                            imgOrig.src = event.target.result;
                            base64Data = event.target.result.split(',')[1];
                            uploadArea.classList.add('hidden');
                            workspace.classList.remove('hidden');
                            workspace.classList.add('flex');
                        };
                        reader.readAsDataURL(file);
                    });

                    btnReset.addEventListener('click', () => {
                        fileInput.value = ''; imgOrig.src = ''; imgRes.src = ''; base64Data = '';
                        imgRes.classList.add('hidden'); btnDown.classList.add('hidden'); btnDown.classList.remove('flex'); btn.classList.remove('hidden'); placeholder.classList.remove('hidden'); errorMsg.classList.add('hidden');
                        workspace.classList.add('hidden'); workspace.classList.remove('flex'); uploadArea.classList.remove('hidden');
                    });

                    btn.addEventListener('click', async () => {
                        btn.classList.add('hidden'); loading.classList.remove('hidden'); loading.classList.add('flex'); errorMsg.classList.add('hidden');
                        try {
                            const apiKey = "AIzaSyCVsdiWuClgi6lTy60z8WxbB6WdBDP6b68";
                            const fn = async () => {
                                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`, {
                                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify({
                                        contents: [{ role: "user", parts: [{ text: "Remove the background of this image perfectly. Output ONLY the foreground subject with a transparent background." }, { inlineData: { mimeType: mimeType, data: base64Data } }] }],
                                        generationConfig: { responseModalities: ["IMAGE"] }
                                    })
                                });
                                if (!response.ok) throw new Error();
                                const data = await response.json();
                                const imgData = data.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData;
                                if (!imgData) throw new Error();
                                return `data:${imgData.mimeType};base64,${imgData.data}`;
                            };
                            const res = await utils.executeWithRetry(fn);
                            imgRes.src = res; btnDown.href = res;
                            imgRes.classList.remove('hidden'); placeholder.classList.add('hidden'); btnDown.classList.remove('hidden'); btnDown.classList.add('flex');
                        } catch (e) {
                            errorMsg.innerText = 'Erro ao processar imagem via API Gemini.'; errorMsg.classList.remove('hidden'); btn.classList.remove('hidden');
                        } finally {
                            loading.classList.add('hidden'); loading.classList.remove('flex');
                        }
                    });
                }
            },
            {
                id: 'pomodoro', title: 'Pomodoro', icon: 'clock', color: 'bg-rose-500',
                html: () => `
          <div class="p-8 max-w-md mx-auto flex flex-col items-center">
            <h2 class="text-2xl font-bold mb-8 flex items-center gap-2"><i data-lucide="clock" class="text-rose-500"></i> Pomodoro Focus</h2>
            <div class="flex gap-4 mb-6">
              <button id="pomo-work" class="px-4 py-2 rounded-full font-bold bg-rose-500 text-white shadow-md transition-colors">Foco Central</button>
              <button id="pomo-break" class="px-4 py-2 rounded-full font-bold bg-gray-100 text-gray-500 hover:bg-gray-200 transition-colors">Pausa Curta</button>
            </div>
            <div id="pomo-circle" class="w-64 h-64 rounded-full flex items-center justify-center shadow-2xl border-8 border-rose-100 bg-rose-50 mb-8 transition-colors duration-500">
              <span id="pomo-time" class="text-7xl font-black text-rose-600 font-mono">25:00</span>
            </div>
            <div class="flex gap-4 w-full">
              <button id="pomo-toggle" class="flex-1 py-4 rounded-xl font-bold text-white shadow-lg bg-rose-600 hover:bg-rose-700">Iniciar Rel√≥gio</button>
              <button id="pomo-reset" class="px-6 py-4 rounded-xl font-bold text-gray-600 bg-gray-200 hover:bg-gray-300">Zerar</button>
            </div>
          </div>`,
                init: () => {
                    let timeLeft = 25 * 60; let isRunning = false; let mode = 'work'; let interval;
                    const display = document.getElementById('pomo-time');
                    const circle = document.getElementById('pomo-circle');
                    const btnToggle = document.getElementById('pomo-toggle');
                    const btnWork = document.getElementById('pomo-work');
                    const btnBreak = document.getElementById('pomo-break');

                    const updateDOM = () => {
                        const m = Math.floor(timeLeft / 60).toString().padStart(2, '0');
                        const s = (timeLeft % 60).toString().padStart(2, '0');
                        display.innerText = `${m}:${s}`;

                        btnWork.className = `px-4 py-2 rounded-full font-bold transition-colors ${mode === 'work' ? 'bg-rose-500 text-white shadow-md' : 'bg-gray-100 text-gray-500'}`;
                        btnBreak.className = `px-4 py-2 rounded-full font-bold transition-colors ${mode === 'break' ? 'bg-emerald-500 text-white shadow-md' : 'bg-gray-100 text-gray-500'}`;
                        circle.className = `w-64 h-64 rounded-full flex items-center justify-center shadow-2xl border-8 mb-8 transition-colors duration-500 ${mode === 'work' ? 'border-rose-100 bg-rose-50' : 'border-emerald-100 bg-emerald-50'}`;
                        display.className = `text-7xl font-black font-mono ${mode === 'work' ? 'text-rose-600' : 'text-emerald-600'}`;

                        if (isRunning) {
                            btnToggle.innerText = 'Pausar Rel√≥gio'; btnToggle.className = 'flex-1 py-4 rounded-xl font-bold text-white shadow-lg bg-orange-500';
                        } else {
                            btnToggle.innerText = 'Iniciar Rel√≥gio'; btnToggle.className = `flex-1 py-4 rounded-xl font-bold text-white shadow-lg ${mode === 'work' ? 'bg-rose-600' : 'bg-emerald-600'}`;
                        }
                    };

                    const tick = () => {
                        if (timeLeft > 0) timeLeft--;
                        else { isRunning = false; clearInterval(interval); mode = mode === 'work' ? 'break' : 'work'; timeLeft = mode === 'work' ? 25 * 60 : 5 * 60; }
                        updateDOM();
                    };

                    btnToggle.addEventListener('click', () => { isRunning = !isRunning; if (isRunning) interval = setInterval(tick, 1000); else clearInterval(interval); updateDOM(); });
                    document.getElementById('pomo-reset').addEventListener('click', () => { isRunning = false; clearInterval(interval); timeLeft = mode === 'work' ? 25 * 60 : 5 * 60; updateDOM(); });
                    btnWork.addEventListener('click', () => { isRunning = false; clearInterval(interval); mode = 'work'; timeLeft = 25 * 60; updateDOM(); });
                    btnBreak.addEventListener('click', () => { isRunning = false; clearInterval(interval); mode = 'break'; timeLeft = 5 * 60; updateDOM(); });

                    app.currentToolCleanup = () => clearInterval(interval);
                }
            },
            {
                id: 'decision', title: 'Decis√µes', icon: 'brain-circuit', color: 'bg-slate-700',
                html: () => `
          <div class="p-8 max-w-3xl mx-auto flex flex-col min-h-full">
            <h2 class="text-2xl font-bold mb-2 flex items-center gap-2"><i data-lucide="brain-circuit" class="text-slate-700"></i> Tomador de Decis√µes IA</h2>
            <p class="text-sm text-gray-500 mb-8">Descreva seu dilema. A IA atuar√° como seu mentor estoico e pessoal.</p>
            <textarea id="dm-input" placeholder="Ex: Devo pedir demiss√£o do meu emprego chato?" class="w-full h-32 p-5 border rounded-2xl outline-none mb-6 resize-none"></textarea>
            <button id="dm-btn" class="w-full bg-slate-800 text-white font-bold py-4 rounded-xl shadow-lg mb-8">Consultar o Mestre</button>
            <div id="dm-loading" class="hidden flex-col items-center justify-center text-slate-400 opacity-70 mb-8"><i data-lucide="brain-circuit" class="w-12 h-12 animate-pulse mb-4"></i><p>Analisando...</p></div>
            <div id="dm-result" class="hidden bg-slate-50 border p-8 rounded-3xl shadow-sm relative overflow-hidden animate-slide-up whitespace-pre-wrap text-slate-700 leading-relaxed border-l-8 border-l-slate-700"></div>
          </div>`,
                init: () => {
                    const input = document.getElementById('dm-input');
                    const btn = document.getElementById('dm-btn');
                    const loading = document.getElementById('dm-loading');
                    const result = document.getElementById('dm-result');

                    btn.addEventListener('click', async () => {
                        const val = input.value.trim(); if (!val) return;
                        btn.disabled = true; loading.classList.remove('hidden'); loading.classList.add('flex'); result.classList.add('hidden');
                        try {
                            const apiKey = "AIzaSyCVsdiWuClgi6lTy60z8WxbB6WdBDP6b68";
                            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                                method: 'POST', headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ contents: [{ parts: [{ text: `Assuma a persona de um mentor s√°bio, est√≥ico e brutalmente honesto. O usu√°rio tem o dilema: "${val}". Fa√ßa uma an√°lise pr√≥s/contras e finalize com uma recomenda√ß√£o filos√≥fica.` }] }] })
                            });
                            const data = await response.json();
                            result.innerText = data.candidates?.[0]?.content?.parts?.[0]?.text || 'Falha no or√°culo.';
                            result.classList.remove('hidden');
                        } catch (e) { result.innerText = 'Erro de API.'; result.classList.remove('hidden'); }
                        finally { btn.disabled = false; loading.classList.add('hidden'); loading.classList.remove('flex'); }
                    });
                }
            },
            {
                id: 'cssgrid', title: 'Grid CSS', icon: 'layout-grid', color: 'bg-indigo-600',
                html: () => `
          <div class="p-8 max-w-5xl mx-auto flex flex-col h-full">
            <h2 class="text-2xl font-bold mb-6 flex items-center gap-2"><i data-lucide="layout-grid" class="text-indigo-600"></i> Gerador de Grid CSS</h2>
            <div class="flex flex-col lg:flex-row gap-8">
              <div class="w-full lg:w-1/3 bg-white border p-6 rounded-3xl shadow-sm space-y-6 h-fit">
                <div><label class="flex justify-between font-bold text-gray-700 mb-2">Colunas <span id="grid-c-val" class="text-indigo-600">3</span></label><input type="range" id="grid-c" min="1" max="12" value="3" class="w-full accent-indigo-600" /></div>
                <div><label class="flex justify-between font-bold text-gray-700 mb-2">Linhas <span id="grid-r-val" class="text-indigo-600">3</span></label><input type="range" id="grid-r" min="1" max="12" value="3" class="w-full accent-indigo-600" /></div>
                <div><label class="flex justify-between font-bold text-gray-700 mb-2">Gap <span id="grid-g-val" class="text-indigo-600">16px</span></label><input type="range" id="grid-g" min="0" max="64" value="16" class="w-full accent-indigo-600" /></div>
                <div class="pt-4 border-t relative group">
                  <span class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-2 block">C√≥digo CSS</span>
                  <button id="grid-copy" class="absolute top-6 right-2 bg-white rounded p-1 shadow hover:bg-gray-100"><i data-lucide="copy" class="w-4 h-4"></i></button>
                  <pre id="grid-code" class="p-4 bg-gray-900 text-indigo-300 rounded-xl text-sm font-mono overflow-x-auto"></pre>
                </div>
              </div>
              <div class="flex-1 bg-gray-100 rounded-3xl p-6 border flex items-center justify-center min-h-[400px]">
                 <div id="grid-preview" class="w-full h-full bg-white/50 rounded-xl border border-dashed border-gray-300 p-4 transition-all" style="display: grid;"></div>
              </div>
            </div>
          </div>`,
                init: () => {
                    const els = { c: document.getElementById('grid-c'), r: document.getElementById('grid-r'), g: document.getElementById('grid-g'), cv: document.getElementById('grid-c-val'), rv: document.getElementById('grid-r-val'), gv: document.getElementById('grid-g-val'), code: document.getElementById('grid-code'), prev: document.getElementById('grid-preview') };

                    const update = () => {
                        const c = els.c.value, r = els.r.value, g = els.g.value;
                        els.cv.innerText = c; els.rv.innerText = r; els.gv.innerText = g + 'px';
                        const code = `.grid-container {\n  display: grid;\n  grid-template-columns: repeat(${c}, 1fr);\n  grid-template-rows: repeat(${r}, 1fr);\n  gap: ${g}px;\n}`;
                        els.code.innerText = code;
                        els.prev.style.gridTemplateColumns = `repeat(${c}, 1fr)`;
                        els.prev.style.gridTemplateRows = `repeat(${r}, 1fr)`;
                        els.prev.style.gap = `${g}px`;

                        let html = '';
                        for (let i = 0; i < c * r; i++) html += `<div class="bg-indigo-500/20 border-2 border-indigo-400/30 rounded-lg flex items-center justify-center font-bold text-indigo-400/50 min-h-[50px]">${i + 1}</div>`;
                        els.prev.innerHTML = html;
                    };
                    ['input', 'change'].forEach(evt => { els.c.addEventListener(evt, update); els.r.addEventListener(evt, update); els.g.addEventListener(evt, update); });
                    document.getElementById('grid-copy').addEventListener('click', () => utils.copyToClipboard(els.code.innerText));
                    update();
                }
            },
            {
                id: 'todo', title: 'Tarefas', icon: 'check-square', color: 'bg-amber-500',
                html: () => `
          <div class="p-8 max-w-2xl mx-auto flex flex-col h-full">
            <div class="flex items-center justify-between mb-8">
              <h2 class="text-2xl font-bold flex items-center gap-2"><i data-lucide="check-square" class="text-amber-500"></i> To-do List</h2>
              <span id="td-status" class="bg-amber-100 text-amber-800 px-3 py-1 rounded-full text-sm font-bold"></span>
            </div>
            <form id="td-form" class="flex gap-3 mb-8">
              <input type="text" id="td-input" placeholder="Nova tarefa..." class="flex-1 p-4 border rounded-xl outline-none" />
              <button type="submit" class="bg-amber-500 text-white font-bold px-8 rounded-xl">+</button>
            </form>
            <div id="td-list" class="space-y-3 overflow-auto flex-1"></div>
          </div>`,
                init: () => {
                    let tasks = [{ id: 1, text: 'Dar estrela neste projeto', done: true }, { id: 2, text: 'Testar a roleta', done: false }];
                    const listEl = document.getElementById('td-list');
                    const statusEl = document.getElementById('td-status');

                    const render = () => {
                        statusEl.innerText = `${tasks.filter(t => t.done).length} de ${tasks.length} conclu√≠das`;
                        if (tasks.length === 0) { listEl.innerHTML = '<div class="text-center py-10"><span class="text-4xl">üèñÔ∏è</span><p class="text-gray-500">Lista vazia!</p></div>'; return; }

                        listEl.innerHTML = tasks.map(t => `
              <div class="flex items-center justify-between p-4 rounded-2xl border ${t.done ? 'bg-gray-50 opacity-60' : 'bg-white shadow-sm'}">
                <label class="flex items-center gap-4 cursor-pointer flex-1 group" onclick="app.todoToggle(${t.id})">
                  <div class="w-6 h-6 rounded border-2 flex items-center justify-center ${t.done ? 'bg-amber-500 border-amber-500' : 'border-gray-300'}">
                    ${t.done ? '<i data-lucide="check" class="text-white w-4 h-4"></i>' : ''}
                  </div>
                  <span class="text-lg font-medium ${t.done ? 'line-through text-gray-400' : ''}">${t.text}</span>
                </label>
                <button onclick="app.todoRemove(${t.id})" class="text-gray-300 hover:text-red-500 p-2"><i data-lucide="trash-2" class="w-5 h-5"></i></button>
              </div>
            `).join('');
                        lucide.createIcons();
                    };

                    app.todoToggle = (id) => { tasks = tasks.map(t => t.id === id ? { ...t, done: !t.done } : t); render(); };
                    app.todoRemove = (id) => { tasks = tasks.filter(t => t.id !== id); render(); };

                    document.getElementById('td-form').addEventListener('submit', (e) => {
                        e.preventDefault(); const inp = document.getElementById('td-input');
                        if (inp.value.trim()) { tasks.unshift({ id: Date.now(), text: inp.value, done: false }); inp.value = ''; render(); }
                    });
                    render();
                }
            },
            {
                id: 'json', title: 'Formatar JSON', icon: 'code', color: 'bg-emerald-600',
                html: () => `
          <div class="p-8 max-w-6xl mx-auto flex flex-col h-full">
            <h2 class="text-2xl font-bold mb-6 flex items-center gap-2"><i data-lucide="code" class="text-emerald-600"></i> Formatador de JSON</h2>
            <div class="flex flex-col lg:flex-row gap-6 h-full min-h-[500px]">
              <div class="flex-1 flex flex-col">
                <textarea id="json-in" placeholder='{"nome":"joao"}' class="flex-1 p-5 border rounded-2xl bg-gray-50 outline-none font-mono text-sm resize-none"></textarea>
                <div class="flex gap-4 mt-4">
                  <button id="json-fmt" class="flex-1 bg-emerald-600 text-white font-bold py-3 rounded-xl">Formatar</button>
                  <button id="json-min" class="flex-1 bg-emerald-100 text-emerald-800 font-bold py-3 rounded-xl">Minificar</button>
                </div>
              </div>
              <div class="flex-1 flex flex-col relative group">
                <button id="json-copy" class="absolute top-4 right-4 z-10 bg-white p-2 rounded shadow opacity-0 group-hover:opacity-100 transition"><i data-lucide="copy" class="w-4 h-4"></i></button>
                <textarea id="json-out" readonly class="flex-1 p-5 border rounded-2xl bg-gray-900 text-emerald-400 outline-none font-mono text-sm resize-none"></textarea>
              </div>
            </div>
          </div>`,
                init: () => {
                    const inp = document.getElementById('json-in'), out = document.getElementById('json-out');
                    document.getElementById('json-fmt').addEventListener('click', () => {
                        try { out.value = JSON.stringify(JSON.parse(inp.value), null, 2); out.classList.remove('text-red-400'); out.classList.add('text-emerald-400'); }
                        catch (e) { out.value = `ERRO: ${e.message}`; out.classList.add('text-red-400'); }
                    });
                    document.getElementById('json-min').addEventListener('click', () => {
                        try { out.value = JSON.stringify(JSON.parse(inp.value || out.value)); out.classList.remove('text-red-400'); out.classList.add('text-emerald-400'); }
                        catch (e) { out.value = `ERRO: ${e.message}`; out.classList.add('text-red-400'); }
                    });
                    document.getElementById('json-copy').addEventListener('click', () => utils.copyToClipboard(out.value));
                }
            },
            {
                id: 'cpf', title: 'Gerador CPF', icon: 'fingerprint', color: 'bg-emerald-700',
                html: () => `
          <div class="p-8 max-w-lg mx-auto flex flex-col items-center">
            <h2 class="text-2xl font-bold mb-2 flex items-center gap-2"><i data-lucide="fingerprint" class="text-emerald-700"></i> Gerador de CPF Falso</h2>
            <p class="text-sm text-gray-500 mb-8 text-center">Gera CPFs matematicamente v√°lidos para testes. N√£o possui v√≠nculo real.</p>
            <div class="w-full bg-white border border-gray-200 p-8 rounded-3xl shadow-sm flex flex-col items-center gap-6">
              <label class="font-bold text-gray-700 cursor-pointer flex items-center gap-2 w-full px-4">
                <input type="checkbox" id="cpf-format" checked class="w-5 h-5 accent-emerald-600" /> Com Pontua√ß√£o
              </label>
              <div class="w-full bg-gray-50 border border-emerald-100 rounded-2xl p-6 flex flex-col items-center justify-center relative shadow-inner group">
                <span id="cpf-display" class="text-4xl font-mono font-bold tracking-widest text-emerald-900 select-all">000.000.000-00</span>
                <button id="cpf-copy" class="absolute top-4 right-4 bg-white p-2 rounded shadow opacity-0 group-hover:opacity-100 transition"><i data-lucide="copy" class="w-4 h-4"></i></button>
              </div>
              <button id="cpf-btn" class="w-full bg-emerald-700 hover:bg-emerald-800 text-white font-bold py-4 rounded-xl shadow-lg transition-transform active:scale-95 flex items-center justify-center gap-2">
                <i data-lucide="refresh-cw" class="w-5 h-5"></i> Gerar Novo CPF
              </button>
            </div>
          </div>`,
                init: () => {
                    const display = document.getElementById('cpf-display');
                    const formatCb = document.getElementById('cpf-format');

                    const generate = () => {
                        const createDigit = (arr) => {
                            let sum = arr.reduce((acc, val, i) => acc + val * (arr.length + 1 - i), 0);
                            let rest = sum % 11;
                            return rest < 2 ? 0 : 11 - rest;
                        };
                        let cpfArr = Array.from({ length: 9 }, () => Math.floor(Math.random() * 10));
                        cpfArr.push(createDigit(cpfArr));
                        cpfArr.push(createDigit(cpfArr));

                        let res = cpfArr.join('');
                        if (formatCb.checked) res = res.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, "$1.$2.$3-$4");
                        display.innerText = res;
                    };

                    document.getElementById('cpf-btn').addEventListener('click', generate);
                    formatCb.addEventListener('change', generate);
                    document.getElementById('cpf-copy').addEventListener('click', () => utils.copyToClipboard(display.innerText));

                    generate();
                }
            },
            {
                id: 'projname', title: 'Nomes Projetos', icon: 'lightbulb', color: 'bg-amber-400',
                html: () => `
          <div class="p-8 max-w-3xl mx-auto flex flex-col h-full">
            <h2 class="text-2xl font-bold mb-2 flex items-center gap-2"><i data-lucide="lightbulb" class="text-amber-400"></i> Nomes para Projetos</h2>
            <p class="text-gray-500 mb-8 text-sm">Descreva sua ideia e a IA do Gemini criar√° nomes modernos e marcantes.</p>
            <form id="proj-form" class="flex gap-3 mb-10">
              <input type="text" id="proj-input" placeholder="Ex: App de delivery saud√°vel" class="flex-1 p-4 border rounded-xl outline-none focus:ring-2 focus:ring-amber-300 shadow-sm text-lg" required />
              <button type="submit" id="proj-btn" class="bg-amber-500 hover:bg-amber-600 text-white font-bold px-8 py-4 rounded-xl shadow-md transition-transform flex items-center gap-2">Gerar Nomes</button>
            </form>
            <div id="proj-loading" class="hidden flex-col items-center justify-center text-amber-500 opacity-70 mb-8">
              <i data-lucide="refresh-cw" class="w-10 h-10 animate-spin mb-4"></i>
              <p class="font-bold">Criando nomes incr√≠veis...</p>
            </div>
            <div id="proj-results" class="grid grid-cols-1 md:grid-cols-2 gap-4 animate-slide-up"></div>
          </div>`,
                init: () => {
                    const form = document.getElementById('proj-form');
                    const input = document.getElementById('proj-input');
                    const btn = document.getElementById('proj-btn');
                    const loading = document.getElementById('proj-loading');
                    const results = document.getElementById('proj-results');

                    app.projCopy = (text) => utils.copyToClipboard(text);

                    form.addEventListener('submit', async (e) => {
                        e.preventDefault();
                        const val = input.value.trim(); if (!val) return;
                        btn.disabled = true; loading.classList.remove('hidden'); loading.classList.add('flex'); results.innerHTML = '';
                        try {
                            const apiKey = "AIzaSyCVsdiWuClgi6lTy60z8WxbB6WdBDP6b68";
                            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                                method: 'POST', headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ contents: [{ parts: [{ text: `Aja como especialista em branding. A ideia √©: "${val}". Gere 5 nomes muito criativos e curtos. Retorne APENAS a lista, um por linha, sem n√∫meros ou introdu√ß√£o.` }] }] })
                            });
                            const data = await response.json();
                            const text = data.candidates?.[0]?.content?.parts?.[0]?.text || '';
                            const names = text.split('\n').map(n => n.trim()).filter(n => n.length > 0);

                            results.innerHTML = names.map(n => `
                <div class="bg-amber-50 border border-amber-100 p-6 rounded-2xl flex items-center justify-between group hover:bg-amber-100 transition-colors shadow-sm">
                   <span class="font-bold text-xl text-gray-800 tracking-tight">${n}</span>
                   <button onclick="app.projCopy('${n}')" class="opacity-0 group-hover:opacity-100 bg-white text-amber-600 border border-amber-200 p-2 rounded shadow"><i data-lucide="copy" class="w-4 h-4"></i></button>
                </div>
              `).join('');
                            lucide.createIcons();
                        } catch (err) {
                            results.innerHTML = '<p class="text-red-500 font-bold">Erro ao conectar com a IA.</p>';
                        } finally {
                            btn.disabled = false; loading.classList.add('hidden'); loading.classList.remove('flex');
                        }
                    });
                }
            },
            {
                id: 'favicon', title: 'Gerador Favicon', icon: 'star', color: 'bg-pink-400',
                html: () => `
          <div class="p-8 max-w-4xl mx-auto flex flex-col items-center">
            <h2 class="text-2xl font-bold mb-8 flex items-center gap-2"><i data-lucide="star" class="text-pink-400"></i> Gerador de Favicon</h2>
            <div class="flex flex-col md:flex-row gap-10 w-full items-start justify-center">
              <div class="flex-1 w-full bg-white p-6 border rounded-3xl shadow-sm space-y-6">
                 <div>
                   <label class="font-bold text-sm text-gray-500 mb-2 block uppercase">Texto ou Emoji (M√°x 2)</label>
                   <input type="text" id="fav-text" value="üöÄ" maxlength="2" class="w-full p-4 border rounded-xl text-center text-2xl outline-none focus:ring-2 focus:ring-pink-300" />
                 </div>
                 <div class="flex gap-4">
                   <div class="flex-1">
                     <label class="font-bold text-sm text-gray-500 mb-2 block uppercase">Cor do Fundo</label>
                     <input type="color" id="fav-bg" value="#8B5CF6" class="w-full h-12 cursor-pointer rounded-xl border-none outline-none" />
                   </div>
                   <div class="flex-1">
                     <label class="font-bold text-sm text-gray-500 mb-2 block uppercase">Cor do Texto</label>
                     <input type="color" id="fav-color" value="#FFFFFF" class="w-full h-12 cursor-pointer rounded-xl border-none outline-none" />
                   </div>
                 </div>
                 <label class="flex items-center gap-3 font-bold text-gray-700 cursor-pointer bg-gray-50 p-4 rounded-xl hover:bg-gray-100">
                   <input type="checkbox" id="fav-round" checked class="w-5 h-5 accent-pink-500" /> Formato Arredondado
                 </label>
              </div>
              <div class="flex-1 flex flex-col items-center justify-center p-8 bg-gray-900 rounded-3xl w-full border-4 border-gray-800 shadow-2xl relative">
                <span class="absolute top-4 left-6 text-gray-500 font-bold uppercase tracking-widest text-xs">Preview</span>
                <div class="bg-gray-800 p-8 rounded-3xl mb-8 flex items-center justify-center shadow-inner border border-gray-700">
                  <canvas id="fav-canvas" width="128" height="128" class="hidden"></canvas>
                  <img id="fav-preview" class="w-32 h-32 drop-shadow-xl" />
                </div>
                <a id="fav-download" download="favicon.png" class="bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 px-8 rounded-xl shadow-lg flex items-center gap-2">
                  <i data-lucide="download" class="w-5 h-5"></i> Baixar Favicon
                </a>
              </div>
            </div>
          </div>`,
                init: () => {
                    const textInp = document.getElementById('fav-text');
                    const bgInp = document.getElementById('fav-bg');
                    const colorInp = document.getElementById('fav-color');
                    const roundCb = document.getElementById('fav-round');
                    const canvas = document.getElementById('fav-canvas');
                    const preview = document.getElementById('fav-preview');
                    const dl = document.getElementById('fav-download');

                    const draw = () => {
                        const ctx = canvas.getContext('2d');
                        ctx.clearRect(0, 0, 128, 128);

                        ctx.fillStyle = bgInp.value;
                        if (roundCb.checked) {
                            ctx.beginPath(); ctx.arc(64, 64, 64, 0, 2 * Math.PI); ctx.fill();
                        } else {
                            ctx.fillRect(0, 0, 128, 128);
                        }

                        ctx.fillStyle = colorInp.value;
                        ctx.font = "bold 72px sans-serif";
                        ctx.textAlign = "center";
                        ctx.textBaseline = "middle";
                        ctx.fillText(textInp.value.substring(0, 2), 64, 72);

                        const dataUrl = canvas.toDataURL('image/png');
                        preview.src = dataUrl;
                        dl.href = dataUrl;
                    };

                    [textInp, bgInp, colorInp].forEach(el => el.addEventListener('input', draw));
                    roundCb.addEventListener('change', draw);
                    draw();
                }
            },
            {
                id: 'dice', title: 'Dado Virtual', icon: 'dices', color: 'bg-fuchsia-500',
                html: () => `
          <div class="p-8 max-w-sm mx-auto flex flex-col items-center">
            <h2 class="text-2xl font-bold mb-8 flex items-center gap-2"><i data-lucide="dices" class="text-fuchsia-500"></i> Dado Virtual</h2>
            <div class="mb-8 w-full">
              <label class="block text-sm font-semibold mb-2 text-gray-600 text-center uppercase tracking-wider">Quantidade de Lados</label>
              <select id="dice-sides" class="w-full p-4 border rounded-xl bg-white outline-none focus:ring-2 focus:ring-fuchsia-300 text-center font-bold text-lg shadow-sm">
                <option value="4">D4 (Lados: 4)</option>
                <option value="6" selected>D6 (Lados: 6)</option>
                <option value="8">D8 (Lados: 8)</option>
                <option value="10">D10 (Lados: 10)</option>
                <option value="12">D12 (Lados: 12)</option>
                <option value="20">D20 (Lados: 20)</option>
                <option value="100">D100 (Lados: 100)</option>
              </select>
            </div>
            <div id="dice-box" class="w-48 h-48 bg-gradient-to-br from-fuchsia-500 to-fuchsia-700 text-white rounded-3xl flex items-center justify-center shadow-2xl mb-10 transform transition-all border-4 border-fuchsia-400">
              <span id="dice-result" class="text-7xl font-black drop-shadow-md">1</span>
            </div>
            <button id="dice-btn" class="bg-gray-900 hover:bg-black text-white px-8 py-4 rounded-xl font-bold shadow-lg w-full text-lg transition-transform active:scale-95">Rolar o Dado</button>
          </div>`,
                init: () => {
                    const btn = document.getElementById('dice-btn');
                    const box = document.getElementById('dice-box');
                    const result = document.getElementById('dice-result');
                    const sidesInput = document.getElementById('dice-sides');
                    let rolling = false;

                    btn.addEventListener('click', () => {
                        if (rolling) return;
                        rolling = true;
                        btn.innerText = 'Rolando...';
                        box.classList.add('animate-bounce', 'rotate-[15deg]', 'scale-110');

                        let counter = 0;
                        const sides = parseInt(sidesInput.value);
                        const interval = setInterval(() => {
                            result.innerText = Math.floor(Math.random() * sides) + 1;
                            counter++;
                            if (counter > 15) {
                                clearInterval(interval);
                                rolling = false;
                                btn.innerText = 'Rolar o Dado';
                                box.classList.remove('animate-bounce', 'rotate-[15deg]', 'scale-110');
                            }
                        }, 50);
                    });
                }
            },
            {
                id: 'roulette', title: 'Roleta de Sorteio', icon: 'rotate-cw', color: 'bg-lime-500',
                html: () => `
          <div class="p-8 max-w-4xl mx-auto flex flex-col h-full">
            <h2 class="text-2xl font-bold mb-8 flex items-center gap-2"><i data-lucide="rotate-cw" class="text-lime-500"></i> Roleta de Sorteio</h2>
            <div class="w-full flex flex-col md:flex-row gap-8 flex-1">
              <div class="flex-1 flex flex-col">
                <label class="block text-sm font-semibold mb-2 text-gray-700">Digite os Nomes/Itens (um por linha)</label>
                <textarea id="rl-input" class="flex-1 min-h-[250px] p-5 border border-gray-200 rounded-2xl bg-white shadow-sm outline-none focus:ring-2 focus:ring-lime-300 resize-none leading-relaxed">Jo√£o\nMaria\nJos√©\nAna\nPedro</textarea>
                <button id="rl-btn" class="mt-4 w-full bg-lime-500 hover:bg-lime-600 text-white font-bold py-4 rounded-xl shadow-lg transition-transform active:scale-95 text-lg">Sortear Vencedor</button>
              </div>
              <div class="flex-1 flex flex-col items-center justify-center bg-gray-900 border border-gray-800 rounded-3xl p-8 shadow-2xl relative overflow-hidden min-h-[300px]">
                 <i id="rl-spin-icon" data-lucide="rotate-cw" class="text-lime-500/20 w-32 h-32 absolute hidden animate-spin"></i>
                 <span id="rl-placeholder" class="text-gray-500 font-medium text-center z-10">O resultado aparecer√° aqui. Pressione Sortear!</span>
                 <span id="rl-fast" class="hidden text-3xl text-center font-bold z-10 text-gray-500 blur-[1px] select-none break-all"></span>
                 <div id="rl-winner-box" class="hidden flex-col items-center">
                   <span class="text-sm font-bold text-lime-400 mb-4 uppercase tracking-widest z-10 animate-fade-in">O Grande Vencedor</span>
                   <span id="rl-winner" class="text-5xl md:text-6xl text-center font-black z-10 text-white break-all drop-shadow-lg animate-slide-up"></span>
                 </div>
              </div>
            </div>
          </div>`,
                init: () => {
                    const btn = document.getElementById('rl-btn');
                    const input = document.getElementById('rl-input');
                    const spinIcon = document.getElementById('rl-spin-icon');
                    const placeholder = document.getElementById('rl-placeholder');
                    const fastDisplay = document.getElementById('rl-fast');
                    const winnerBox = document.getElementById('rl-winner-box');
                    const winnerText = document.getElementById('rl-winner');
                    let spinning = false;

                    btn.addEventListener('click', () => {
                        if (spinning) return;
                        const list = input.value.split('\n').map(i => i.trim()).filter(i => i !== '');
                        if (list.length < 2) return alert('Adicione pelo menos 2 itens para sortear.');

                        spinning = true;
                        btn.innerText = 'Rodando a Roleta...';
                        placeholder.classList.add('hidden');
                        winnerBox.classList.add('hidden');
                        spinIcon.classList.remove('hidden');
                        fastDisplay.classList.remove('hidden');

                        let counter = 0;
                        const interval = setInterval(() => {
                            fastDisplay.innerText = list[Math.floor(Math.random() * list.length)];
                            counter++;
                            if (counter > 25) {
                                clearInterval(interval);
                                spinning = false;
                                btn.innerText = 'Sortear Vencedor';
                                spinIcon.classList.add('hidden');
                                fastDisplay.classList.add('hidden');
                                winnerBox.classList.remove('hidden');
                                winnerBox.classList.add('flex');
                                winnerText.innerText = `üéâ ${fastDisplay.innerText} üéâ`;
                            }
                        }, 80);
                    });
                }
            },
            {
                id: 'mindmap', title: 'Mapa Mental', icon: 'network', color: 'bg-sky-500',
                html: () => `
          <div class="p-8 max-w-4xl mx-auto flex flex-col h-full">
            <h2 class="text-2xl font-bold mb-2 flex items-center gap-2"><i data-lucide="network" class="text-sky-500"></i> Mapa Mental Autom√°tico</h2>
            <p class="text-gray-500 mb-6 text-sm">A Intelig√™ncia Artificial vai quebrar o seu tema em ramifica√ß√µes l√≥gicas.</p>
            <form id="mm-form" class="flex flex-col sm:flex-row gap-3 mb-8">
              <input type="text" id="mm-input" placeholder="Tema (Ex: IA na Medicina)" class="flex-1 p-4 border border-gray-200 rounded-xl outline-none focus:ring-2 focus:ring-sky-300 bg-white shadow-sm" required />
              <button type="submit" id="mm-btn" class="bg-sky-500 hover:bg-sky-600 text-white font-bold px-8 py-4 rounded-xl flex items-center justify-center gap-2 shadow-md transition-all whitespace-nowrap">Gerar Mapa Mental</button>
            </form>
            <div id="mm-loading" class="hidden flex-1 items-center justify-center text-sky-600 font-medium animate-pulse"><i data-lucide="refresh-cw" class="w-6 h-6 animate-spin mr-2 inline"></i>A IA est√° estruturando...</div>
            <div id="mm-result-box" class="hidden bg-slate-900 border border-slate-800 shadow-xl p-8 rounded-3xl w-full flex-1 overflow-auto relative group">
               <button id="mm-copy" class="absolute top-4 right-4 bg-white/10 p-2 rounded text-white hover:bg-white/20 border-0 opacity-0 group-hover:opacity-100 transition-opacity"><i data-lucide="copy" class="w-4 h-4"></i></button>
               <pre id="mm-output" class="whitespace-pre-wrap font-sans text-sky-50 text-base leading-loose"></pre>
            </div>
          </div>`,
                init: () => {
                    const form = document.getElementById('mm-form');
                    const input = document.getElementById('mm-input');
                    const btn = document.getElementById('mm-btn');
                    const loading = document.getElementById('mm-loading');
                    const resultBox = document.getElementById('mm-result-box');
                    const output = document.getElementById('mm-output');

                    form.addEventListener('submit', async (e) => {
                        e.preventDefault();
                        const topic = input.value.trim(); if (!topic) return;
                        btn.disabled = true; resultBox.classList.add('hidden'); loading.classList.remove('hidden'); loading.classList.add('flex');
                        try {
                            const apiKey = "AIzaSyCVsdiWuClgi6lTy60z8WxbB6WdBDP6b68";
                            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                                method: 'POST', headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ contents: [{ parts: [{ text: `Aja como um especialista em organiza√ß√£o. Crie um mapa mental sobre o tema: "${topic}". Retorne ESTRITAMENTE em formato de listas Markdown aninhadas (-). Seja detalhado. N√£o adicione textos de introdu√ß√£o.` }] }] })
                            });
                            const data = await response.json();
                            output.innerText = data.candidates?.[0]?.content?.parts?.[0]?.text || 'Erro de formata√ß√£o.';
                            resultBox.classList.remove('hidden');
                        } catch (err) {
                            output.innerText = 'Falha ao conectar com a IA.'; resultBox.classList.remove('hidden');
                        } finally {
                            btn.disabled = false; loading.classList.add('hidden'); loading.classList.remove('flex');
                        }
                    });
                    document.getElementById('mm-copy').addEventListener('click', () => utils.copyToClipboard(output.innerText));
                }
            },
            {
                id: 'dates', title: 'Calc. Datas', icon: 'calendar-days', color: 'bg-violet-500',
                html: () => `
          <div class="p-8 max-w-2xl mx-auto flex flex-col items-center">
            <h2 class="text-2xl font-bold mb-8 flex items-center gap-2"><i data-lucide="calendar-days" class="text-violet-500"></i> Calculadora de Datas</h2>
            <div class="w-full bg-white p-8 rounded-3xl border border-gray-100 shadow-sm mb-8">
              <h3 class="font-bold text-gray-800 mb-6 text-center text-lg">Descubra a dist√¢ncia entre duas datas</h3>
              <div class="flex flex-col md:flex-row gap-6 mb-8 items-center">
                <div class="w-full">
                  <label class="block text-xs font-bold text-gray-400 mb-2 uppercase tracking-wide">Data Inicial</label>
                  <input type="date" id="date-start" class="w-full p-4 border rounded-xl bg-gray-50 outline-none focus:ring-2 focus:ring-violet-300" />
                </div>
                <i data-lucide="arrow-right-left" class="text-gray-300 shrink-0 hidden md:block mt-6"></i>
                <div class="w-full">
                  <label class="block text-xs font-bold text-gray-400 mb-2 uppercase tracking-wide">Data Final</label>
                  <input type="date" id="date-end" class="w-full p-4 border rounded-xl bg-gray-50 outline-none focus:ring-2 focus:ring-violet-300" />
                </div>
              </div>
              <div class="grid grid-cols-3 gap-4">
                <div class="bg-violet-50 border border-violet-100 p-4 rounded-2xl flex flex-col items-center text-center">
                   <span id="dt-days" class="text-3xl font-black text-violet-700">-</span><span class="text-xs font-bold text-violet-400 uppercase mt-1">Dias</span>
                </div>
                <div class="bg-violet-50 border border-violet-100 p-4 rounded-2xl flex flex-col items-center text-center opacity-70">
                   <span id="dt-months" class="text-xl font-bold text-violet-700">-</span><span class="text-xs font-bold text-violet-400 uppercase mt-1">Meses Aprox.</span>
                </div>
                <div class="bg-violet-50 border border-violet-100 p-4 rounded-2xl flex flex-col items-center text-center opacity-70">
                   <span id="dt-years" class="text-xl font-bold text-violet-700">-</span><span class="text-xs font-bold text-violet-400 uppercase mt-1">Anos</span>
                </div>
              </div>
            </div>
          </div>`,
                init: () => {
                    const start = document.getElementById('date-start');
                    const end = document.getElementById('date-end');
                    const dDays = document.getElementById('dt-days');
                    const dMon = document.getElementById('dt-months');
                    const dYr = document.getElementById('dt-years');

                    const calcDiff = () => {
                        if (!start.value || !end.value) { dDays.innerText = '-'; dMon.innerText = '-'; dYr.innerText = '-'; return; }
                        const d1 = new Date(start.value); const d2 = new Date(end.value);
                        const diffTime = Math.abs(d2 - d1);
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        const diffMonths = (Math.abs(d2.getFullYear() - d1.getFullYear()) * 12) + Math.abs(d2.getMonth() - d1.getMonth());
                        const diffYears = Math.abs(d2.getFullYear() - d1.getFullYear());

                        dDays.innerText = diffDays; dMon.innerText = diffMonths; dYr.innerText = diffYears;
                    };
                    start.addEventListener('change', calcDiff); end.addEventListener('change', calcDiff);
                }
            },
            {
                id: 'colorpicker', title: 'Color Picker', icon: 'pipette', color: 'bg-pink-600',
                html: () => `
          <div class="p-8 max-w-lg mx-auto flex flex-col items-center">
            <h2 class="text-2xl font-bold mb-8 flex items-center gap-2"><i data-lucide="pipette" class="text-pink-600"></i> Seletor de Cores</h2>
            <div class="w-full bg-white p-8 border border-gray-100 rounded-[2rem] shadow-sm flex flex-col items-center">
              <div class="relative mb-8 group cursor-pointer">
                 <div id="cp-circle" class="w-48 h-48 rounded-full shadow-lg transition-colors border-[6px] border-white outline outline-1 outline-gray-200" style="background-color: #8B5CF6"></div>
                 <input type="color" id="cp-input" value="#8B5CF6" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" />
                 <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 rounded-full transition-colors flex items-center justify-center pointer-events-none">
                   <span class="opacity-0 group-hover:opacity-100 text-white font-bold bg-black/50 px-3 py-1 rounded-full text-sm">Mudar Cor</span>
                 </div>
              </div>
              <div class="w-full space-y-4">
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-2xl border hover:border-pink-200 transition-colors">
                  <span class="font-bold text-gray-400 uppercase text-xs">HEX</span>
                  <span id="cp-hex" class="font-mono text-gray-800 font-bold text-lg">#8B5CF6</span>
                  <button id="cp-btn-hex" class="bg-white p-2 rounded shadow-sm text-gray-500 hover:text-gray-800"><i data-lucide="copy" class="w-4 h-4"></i></button>
                </div>
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-2xl border hover:border-pink-200 transition-colors">
                  <span class="font-bold text-gray-400 uppercase text-xs">RGB</span>
                  <span id="cp-rgb" class="font-mono text-gray-800 font-bold">rgb(139, 92, 246)</span>
                  <button id="cp-btn-rgb" class="bg-white p-2 rounded shadow-sm text-gray-500 hover:text-gray-800"><i data-lucide="copy" class="w-4 h-4"></i></button>
                </div>
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-2xl border hover:border-pink-200 transition-colors">
                  <span class="font-bold text-gray-400 uppercase text-xs">HSL</span>
                  <span id="cp-hsl" class="font-mono text-gray-800 font-bold">hsl(258, 90%, 66%)</span>
                  <button id="cp-btn-hsl" class="bg-white p-2 rounded shadow-sm text-gray-500 hover:text-gray-800"><i data-lucide="copy" class="w-4 h-4"></i></button>
                </div>
              </div>
            </div>
          </div>`,
                init: () => {
                    const inp = document.getElementById('cp-input');
                    const circle = document.getElementById('cp-circle');
                    const vHex = document.getElementById('cp-hex'); const vRgb = document.getElementById('cp-rgb'); const vHsl = document.getElementById('cp-hsl');

                    const hexToRgb = (h) => {
                        const r = parseInt(h.slice(1, 3), 16), g = parseInt(h.slice(3, 5), 16), b = parseInt(h.slice(5, 7), 16);
                        return `rgb(${r}, ${g}, ${b})`;
                    };
                    const hexToHsl = (h) => {
                        let r = parseInt(h.slice(1, 3), 16) / 255, g = parseInt(h.slice(3, 5), 16) / 255, b = parseInt(h.slice(5, 7), 16) / 255;
                        const max = Math.max(r, g, b), min = Math.min(r, g, b); let hu, s, l = (max + min) / 2;
                        if (max === min) { hu = s = 0; } else {
                            const d = max - min; s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                            switch (max) { case r: hu = (g - b) / d + (g < b ? 6 : 0); break; case g: hu = (b - r) / d + 2; break; case b: hu = (r - g) / d + 4; break; }
                            hu /= 6;
                        }
                        return `hsl(${Math.round(hu * 360)}, ${Math.round(s * 100)}%, ${Math.round(l * 100)}%)`;
                    };

                    const update = () => {
                        const h = inp.value; circle.style.backgroundColor = h;
                        vHex.innerText = h.toUpperCase(); vRgb.innerText = hexToRgb(h); vHsl.innerText = hexToHsl(h);
                    };
                    inp.addEventListener('input', update);

                    document.getElementById('cp-btn-hex').addEventListener('click', () => utils.copyToClipboard(vHex.innerText));
                    document.getElementById('cp-btn-rgb').addEventListener('click', () => utils.copyToClipboard(vRgb.innerText));
                    document.getElementById('cp-btn-hsl').addEventListener('click', () => utils.copyToClipboard(vHsl.innerText));
                }
            },
            {
                id: 'base64', title: 'Base64', icon: 'binary', color: 'bg-blue-600',
                html: () => `
          <div class="p-8 max-w-4xl mx-auto flex flex-col h-full">
            <h2 class="text-2xl font-bold mb-6 flex items-center gap-2"><i data-lucide="binary" class="text-blue-600"></i> Conversor Base64</h2>
            <div class="bg-gray-100 p-2 rounded-2xl flex gap-2 mb-6">
              <button id="b64-enc" class="flex-1 py-3 rounded-xl font-bold shadow-sm bg-blue-600 text-white transition-all">Codificar Texto</button>
              <button id="b64-dec" class="flex-1 py-3 rounded-xl font-bold bg-transparent text-gray-500 hover:text-gray-800 hover:bg-gray-200 transition-all">Decodificar Base64</button>
            </div>
            <div class="flex flex-col lg:flex-row gap-6 flex-1 min-h-[300px]">
              <textarea id="b64-in" placeholder="Cole o texto ou c√≥digo aqui..." class="flex-1 p-5 border rounded-2xl bg-white shadow-inner outline-none focus:ring-2 focus:ring-blue-300 font-mono resize-none"></textarea>
              <div class="flex items-center justify-center lg:flex-col gap-4">
                 <button id="b64-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold p-4 rounded-2xl shadow-md transition-transform active:scale-95 text-center">
                   Processar <br class="hidden lg:block"/>‚ûî
                 </button>
              </div>
              <div class="flex-1 relative group">
                 <button id="b64-copy" class="absolute top-4 right-4 z-10 bg-white p-2 rounded shadow opacity-0 group-hover:opacity-100 transition"><i data-lucide="copy" class="w-4 h-4"></i></button>
                 <textarea id="b64-out" readonly placeholder="Resultado final..." class="w-full h-full p-5 border border-blue-100 rounded-2xl bg-blue-50/50 outline-none font-mono resize-none text-blue-900"></textarea>
              </div>
            </div>
          </div>`,
                init: () => {
                    let mode = 'encode';
                    const btnEnc = document.getElementById('b64-enc'); const btnDec = document.getElementById('b64-dec');
                    const inp = document.getElementById('b64-in'); const out = document.getElementById('b64-out');

                    const updateTabs = () => {
                        btnEnc.className = mode === 'encode' ? 'flex-1 py-3 rounded-xl font-bold shadow-sm bg-blue-600 text-white transition-all' : 'flex-1 py-3 rounded-xl font-bold bg-transparent text-gray-500 hover:text-gray-800 hover:bg-gray-200 transition-all';
                        btnDec.className = mode === 'decode' ? 'flex-1 py-3 rounded-xl font-bold shadow-sm bg-blue-600 text-white transition-all' : 'flex-1 py-3 rounded-xl font-bold bg-transparent text-gray-500 hover:text-gray-800 hover:bg-gray-200 transition-all';
                        out.value = ''; inp.placeholder = mode === 'encode' ? 'Cole o texto para codificar...' : 'Cole o c√≥digo Base64 para decodificar...';
                    };
                    btnEnc.addEventListener('click', () => { mode = 'encode'; updateTabs(); });
                    btnDec.addEventListener('click', () => { mode = 'decode'; updateTabs(); });

                    document.getElementById('b64-btn').addEventListener('click', () => {
                        try {
                            if (mode === 'encode') out.value = btoa(unescape(encodeURIComponent(inp.value)));
                            else out.value = decodeURIComponent(escape(atob(inp.value)));
                        } catch (e) { out.value = 'ERRO: Formato inv√°lido.'; }
                    });
                    document.getElementById('b64-copy').addEventListener('click', () => utils.copyToClipboard(out.value));
                }
            },
            {
                id: 'compressor', title: 'Compressor', icon: 'file-down', color: 'bg-orange-600',
                html: () => `
          <div class="p-8 max-w-5xl mx-auto flex flex-col items-center">
            <h2 class="text-2xl font-bold mb-2 flex items-center gap-2"><i data-lucide="file-down" class="text-orange-600"></i> Compressor de Imagem</h2>
            <p class="text-sm text-gray-500 mb-8 text-center">Reduza o tamanho da imagem na hora, 100% offline no seu navegador.</p>
            
            <label id="cmp-upload-area" class="w-full max-w-xl h-64 border-2 border-dashed border-orange-300 bg-orange-50 hover:bg-orange-100 transition-colors rounded-3xl flex flex-col items-center justify-center cursor-pointer text-orange-700">
              <i data-lucide="upload" class="w-10 h-10 mb-4 text-orange-400"></i>
              <span class="font-semibold text-lg">Selecione uma Imagem</span>
              <span class="text-sm opacity-70 mt-1">Converte automaticamente para JPG</span>
              <input type="file" id="cmp-file" class="hidden" accept="image/*" />
            </label>

            <div id="cmp-workspace" class="hidden w-full space-y-8">
              <div class="bg-white p-8 border border-gray-100 rounded-3xl shadow-sm">
                 <div class="flex items-center justify-between mb-4">
                   <label class="font-bold text-gray-700">Qualidade de Compress√£o: <span id="cmp-q-val" class="text-orange-600">70%</span></label>
                   <span id="cmp-badge" class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-bold uppercase hidden">X% mais leve</span>
                 </div>
                 <input type="range" id="cmp-quality" min="0.1" max="1" step="0.05" value="0.7" class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-orange-500" />
              </div>
              <div class="flex flex-col md:flex-row gap-6 items-stretch justify-center">
                 <div class="flex-1 flex flex-col items-center bg-gray-50 p-6 rounded-3xl border relative">
                   <span class="absolute top-4 left-4 bg-gray-200 text-gray-600 text-xs font-bold px-2 py-1 rounded">Antes</span>
                   <img id="cmp-orig-img" class="w-full h-64 object-contain rounded-xl bg-white/50 mb-4" />
                   <span id="cmp-orig-size" class="font-bold text-gray-800 text-xl">0 KB</span>
                 </div>
                 <div class="flex items-center justify-center"><div class="bg-white rounded-full p-3 shadow-md border"><i data-lucide="arrow-right-left" class="text-orange-400"></i></div></div>
                 <div class="flex-1 flex flex-col items-center bg-orange-50 p-6 rounded-3xl border border-orange-100 relative shadow-inner">
                   <span class="absolute top-4 left-4 bg-orange-200 text-orange-800 text-xs font-bold px-2 py-1 rounded">Depois</span>
                   <img id="cmp-res-img" class="w-full h-64 object-contain rounded-xl bg-white shadow-sm mb-4" />
                   <span id="cmp-res-size" class="font-black text-orange-600 text-xl">0 KB</span>
                 </div>
              </div>
              <div class="flex justify-center gap-4 mt-6">
                <button id="cmp-reset" class="px-8 py-4 bg-gray-100 text-gray-700 hover:bg-gray-200 rounded-xl font-bold">Tentar Outra</button>
                <a id="cmp-download" download="imagem-comprimida.jpg" class="px-8 py-4 bg-orange-500 hover:bg-orange-600 text-white rounded-xl font-bold flex items-center gap-2 shadow-xl shadow-orange-500/20"><i data-lucide="download"></i> Baixar JPG</a>
              </div>
            </div>
          </div>`,
                init: () => {
                    let origSrc = null, origBytes = 0;
                    const uArea = document.getElementById('cmp-upload-area'), wSpace = document.getElementById('cmp-workspace');
                    const fileInp = document.getElementById('cmp-file'), qInp = document.getElementById('cmp-quality');
                    const oImg = document.getElementById('cmp-orig-img'), rImg = document.getElementById('cmp-res-img');
                    const oSize = document.getElementById('cmp-orig-size'), rSize = document.getElementById('cmp-res-size');
                    const badge = document.getElementById('cmp-badge'), qVal = document.getElementById('cmp-q-val');
                    const dl = document.getElementById('cmp-download');

                    const compress = () => {
                        if (!origSrc) return;
                        const q = parseFloat(qInp.value); qVal.innerText = Math.round(q * 100) + '%';
                        const img = new Image(); img.src = origSrc;
                        img.onload = () => {
                            const canvas = document.createElement('canvas');
                            canvas.width = img.width; canvas.height = img.height;
                            const ctx = canvas.getContext('2d'); ctx.drawImage(img, 0, 0);
                            const dataUrl = canvas.toDataURL('image/jpeg', q);
                            rImg.src = dataUrl; dl.href = dataUrl;

                            const base64str = dataUrl.split('base64,')[1];
                            const newBytes = atob(base64str).length;
                            rSize.innerText = utils.formatBytes(newBytes);

                            if (origBytes) {
                                const diff = Math.round(100 - ((newBytes / origBytes) * 100));
                                if (diff > 0) { badge.innerText = diff + '% mais leve'; badge.classList.remove('hidden'); }
                                else badge.classList.add('hidden');
                            }
                        };
                    };

                    fileInp.addEventListener('change', e => {
                        const f = e.target.files[0]; if (!f) return;
                        origBytes = f.size; oSize.innerText = utils.formatBytes(origBytes);
                        const reader = new FileReader();
                        reader.onload = (ev) => {
                            origSrc = ev.target.result; oImg.src = origSrc;
                            uArea.classList.add('hidden'); wSpace.classList.remove('hidden');
                            compress();
                        };
                        reader.readAsDataURL(f);
                    });

                    qInp.addEventListener('input', compress);
                    document.getElementById('cmp-reset').addEventListener('click', () => {
                        fileInp.value = ''; origSrc = null; origBytes = 0;
                        wSpace.classList.add('hidden'); uArea.classList.remove('hidden'); uArea.classList.add('flex');
                    });
                }
            }
        ];

        // --- Core Framework ---
        const app = {
            activeTool: null,
            currentToolCleanup: null,

            init: () => {
                app.renderGrid();
                lucide.createIcons();
            },

            renderGrid: () => {
                const grid = document.getElementById('tools-grid');
                grid.innerHTML = toolsData.map(tool => `
          <div onclick="app.openTool('${tool.id}')" class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-all duration-300 flex flex-col items-center text-center group">
            <div class="${tool.color} text-white p-4 rounded-2xl mb-4 group-hover:scale-110 transition-transform duration-300 shadow-sm">
              <i data-lucide="${tool.icon}" class="w-8 h-8 stroke-[1.5]"></i>
            </div>
            <h3 class="font-semibold text-gray-800">${tool.title}</h3>
          </div>
        `).join('');
            },

            openTool: (id) => {
                if (app.currentToolCleanup) app.currentToolCleanup();
                app.activeTool = id;
                const tool = toolsData.find(t => t.id === id);

                document.getElementById('view-home').classList.add('hidden');
                document.getElementById('btn-back').classList.remove('hidden');
                document.getElementById('btn-back').classList.add('flex');

                const container = document.getElementById('tool-container');
                container.innerHTML = tool.html();

                const viewTool = document.getElementById('view-tool');
                viewTool.classList.remove('hidden');

                // Execute tool specific logic
                if (tool.init) tool.init();

                lucide.createIcons();
            },

            goHome: () => {
                if (app.currentToolCleanup) { app.currentToolCleanup(); app.currentToolCleanup = null; }
                app.activeTool = null;
                document.getElementById('view-tool').classList.add('hidden');
                document.getElementById('btn-back').classList.add('hidden');
                document.getElementById('btn-back').classList.remove('flex');

                const home = document.getElementById('view-home');
                home.classList.remove('hidden');
                // retrigger animation
                home.classList.remove('animate-fade-in'); void home.offsetWidth; home.classList.add('animate-fade-in');
            }
        };

        // Bootstrap
        window.addEventListener('DOMContentLoaded', app.init);

    </script>
</body>

</html>